<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>loading...</title>
    <meta name="color-scheme" content="light dark">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/vendors/github-markdown.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.6/katex.min.css" integrity="sha512-kZNsJznccVXEWz7/xUNAv9kZb0rikSLqgv6s0KRa64HBdiTKODczgMh/a61gIFTsyEK7BlJeTdfptyeRucj0gA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" id="__hljs__">
    <script src="/vendors/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.6/katex.min.js" integrity="sha512-ZzM/Uqhj1eqNuEJogsoiJ502Z42nrIk1PS6NBSZswLpNSXyWyRBqxcM1S3Z5fP8ZmIXIpUFYWxgQHriLfGr1XQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>.mermaid { text-align: center; }</style>
</head>
<body class="markdown-body" style="max-width: 70ch; margin: 1em auto; padding: 0 2ch;">
    <script id="__END__" src="/vendors/marked.min.js"></script>
    <script type="module">
        const mermaidLink = document.createElement('script')
        mermaidLink.src = '/vendors/mermaid.min.js'
        const light = "/vendors/github.min.css"
        const dark = "/vendors/github-dark.min.css"
        const themeLink = document.getElementById("__hljs__")
        const darkTheme = matchMedia('(prefers-color-scheme: dark)')
        darkTheme.onchange = ({ matches }) => {
            themeLink.href = matches ? dark : light
        }
        darkTheme.onchange(darkTheme)
        const refreshMermaid = () => {
            Array.from(body.querySelectorAll('.mermaid')).forEach((e, i) => {
                if (!(typeof mermaid < 'u') || e.dataset.processed) return
                mermaid.mermaidAPI.render(`mermaid-${i}`, e.textContent, (svg) => {
                    e.innerHTML = svg
                })
            })
        }
        mermaidLink.onload = () => {
            const { matches } = darkTheme
            mermaid.initialize({ startOnLoad: false, theme: matches ? 'dark' : 'default' })
            refreshMermaid()
        }
        const __END__ = document.getElementById('__END__')
        const source = new EventSource('/__source')
        const template = document.createElement('template')
        const body = document.body
        body.appendChild(mermaidLink)
        marked.setOptions({
            highlight(code, lang) {
                const language = hljs.getLanguage(lang) ? lang : 'plaintext'
                return hljs.highlight(code, { language }).value
            }
        })
        marked.use({
            tokenizer: {
                code(src) {
                    const match = src.match(/^\$\$([\s\S]+?)\$\$/)
                    if (match) {
                        return {
                            type: 'math-block',
                            raw: match[0],
                            text: match[1].trim()
                        }
                    }
                    return false
                },
                codespan(src) {
                    const match = src.match(/^\$([^\$\n]+?)\$/)
                    if (match) {
                        return {
                            type: 'math',
                            raw: match[0],
                            text: match[1].trim()
                        }
                    }
                    return false
                }
            },
            extensions: [{
                name: 'math',
                level: 'inline',
                renderer({ text }) {
                    return katex.renderToString(text, { throwOnError: false })
                }
            }, {
                name: 'math-block',
                level: 'block',
                renderer({ text }) {
                    return katex.renderToString(text, { displayMode: true, throwOnError: false })
                }
            }],
            renderer: {
                listitem(text, task, checked) {
                    if (task) {
                        text = text.replace('type="checkbox">', checked
                            ? 'class="task-list-item-checkbox" type="checkbox" checked>'
                            : 'class="task-list-item-checkbox" type="checkbox">'
                        )
                        return '<li class="task-list-item">' + text + '</li>'
                    }
                    return '<li>' + text + '</li>'
                },
                list(body, ordered, start) {
                    const tag = ordered ? 'ol' : 'ul'
                    const suffix = body.includes('<li class="task-list-item">')
                        ? ' class="contains-task-list">'
                        : '>'
                    return '<' + tag + suffix + body + '</' + tag + '>'
                },
                code(code, lang) {
                    if (lang === 'mermaid') {
                        return '<div class="mermaid">' + code + '</div>'
                    }
                    return false
                },
            }
        })
        let raf = 0
        source.onmessage = ({ data }) => {
            const text = JSON.parse(data)
            template.innerHTML = marked.parse(text)
            const node = template.content.cloneNode(true)
            while (body.firstChild !== __END__) {
                body.removeChild(body.firstChild)
            }
            body.insertBefore(node, __END__)
            cancelAnimationFrame(raf)
            raf = requestAnimationFrame(() => {
                const maybeTitle = document.querySelector('h1, h2')
                document.title = maybeTitle ? maybeTitle.textContent : 'Untitled'
                refreshMermaid()
            })
        }
    </script>
</body>
</html>
